<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script>
    class PromiseStatusEnum {
        static get PENDING() {
            return 'pending'
        }

        static get FULFILLED() {
            return 'fulfilled'
        }

        static get REJECTED() {
            return 'rejected'
        }
    }

    function Promise(execute) {
        debugger
        this.data = null;
        this.status = PromiseStatusEnum.PENDING
        this.resolveCallBack = []
        this.rejectCallBack = []

        function resolve() {
            this.status = PromiseStatusEnum.FULFILLED
            let param = arguments[0]

            this.resolveCallBack.forEach((item, key, arr) => {
                param = item(param)
                // arr.shift()
            })
        }

        function reject() {
            this.status = PromiseStatusEnum.REJECTED
            let args = Array.prototype.slice.call(arguments)

            this.rejectCallBack.forEach((item, key, arr) => {
                item.apply(null, args)
                arr.shift()
            })
        }

        setTimeout(() => {
            execute(resolve.bind(this), reject.bind(this))
        }, 0)

    }


    Promise.prototype.then = function (resolveFun,rejectFun) {
        if (typeof resolveFun === 'function') {
            this.resolveCallBack.push(resolveFun);
        } else {
            throw new Error('缺少回调函数');
        }
        this.rejectCallBack.push(resolveFun);
        return this;
    }
    debugger
    // var promise = new Promise(function (resolve, reject) {
    //     resolve("123")
    // })
    // promise.then((val) => {
    //     console.log(val)
    // })

    var p = new Promise((resolve,reject)=>{
        debugger
        var flag = Math.random();
        if (true){
            resolve("ok")
        }else {
            reject("errr")
        }
    })
    p.then((data)=>{
        debugger
        console.log(data)
        return data+"2"
    },(err)=>{
        console.log(err)
    }).then((data)=>{
        console.log(data)
    })
</script>
<body>

</body>
</html>